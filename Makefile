################################################################
# CONFIG
################################################################
IDIR=include
SRC=src
DEP=dep
CC=msp430-gcc
CFLAGS=-I$(IDIR) -mmcu=msp430g2553
PROJ_NAME=acc_rcv

################################################################
# PATHS
################################################################
ODIR=obj
LDIR=lib

#LIBS=-lm
LIBS=

_SOURCES = main.c cc110l.c spi.c uart.c
SOURCES = $(patsubst %,$(SRC)/%,$(_SOURCES))

_OBJ = $(patsubst %.c,%.o,$(_SOURCES))
OBJ = $(patsubst %,$(ODIR)/%,$(_OBJ))

################################################################
# ALL
################################################################
all: $(PROJ_NAME)

################################################################
# MAIN
################################################################
$(PROJ_NAME): $(OBJ)
	$(CC) -o $@ $^ $(CFLAGS) $(LIBS)

################################################################
# PHONIES CONFIG
################################################################
.PHONY: clean all

################################################################
# DEPENDENCIES
################################################################
$(DEP)/%.d: $(SRC)/%.c
	@set -e; rm -f $@; \
	$(CC) -M $(CPPFLAGS) -I $(IDIR) $< > $@.$$$$; \
	sed 's,\($*\)\.o[ :]*,$(ODIR)/\1.o $@ : ,g' < $@.$$$$ > $@; \
	rm -f $@.$$$$

################################################################
# INCLUDE DEPENDENCIES TO THIS MAKEFILE
################################################################
_DEPS = $(patsubst %.c,%.d,$(_SOURCES))
DEPS = $(patsubst %,$(DEP)/%,$(_DEPS))
-include $(DEPS)

################################################################
# OBJECTS
################################################################
$(ODIR)/%.o: $(SRC)/%.c $(DEP)/%.d
	$(CC) -c -o $@ $< $(CFLAGS)

################################################################
# CLEAN
################################################################
clean:
	rm -f $(PROJ_NAME) $(ODIR)/*.o $(DEP)/*.d $(ODIR)/*.d.* *~ core $(INCDIR)/*~
